---
- name: test that single threaded resources are correctly added to ipc-env.re
  hosts: localhost
  gather_facts: false
  vars:
    ipc_env: "{{ lookup('template', '../templates/ipc-env.re.j2') }}"
  tasks:
    - name: include the default variables 
      include_vars: ../defaults/main.yml

    - name: add some single threaded resources
      include_vars: single_threaded_resources.yml

    - name: verify acSetNumThreads defined correctly in ipc-env.re
      assert:
        that:
          - ipc_env|search("acSetNumThreads")
          - ipc_env|search("ON($rescName == 'resource-1' && $clientAddr == ipc_IES_IP)"|regex_escape())
          - ipc_env|search("ON($rescName == 'resource-2' && $clientAddr == ipc_IES_IP)"|regex_escape())
